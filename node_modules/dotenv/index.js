import fs from 'fs';
import path from 'path';

export function config() {
  const envFile = fs.existsSync('.env') ? '.env' : '.env.example';
  const envPath = path.resolve(envFile);
  const data = fs.readFileSync(envPath, 'utf8');
  const parsed = {};
  for (const line of data.split(/\r?\n/)) {
    if (!line || line.trim().startsWith('#')) continue;
    const match = line.match(/^([^=\s]+)\s*=\s*(.*)$/);
    if (match) {
      let [, key, value] = match;
      value = value.trim();
      if (value.startsWith('"') && value.endsWith('"')) {
        value = value.slice(1, -1);
      }
      if (!(key in process.env)) {
        process.env[key] = value;
      }
      parsed[key] = value;
    }
  }
  return { parsed };
}
